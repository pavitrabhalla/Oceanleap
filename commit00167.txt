M7data handling code cleanup and minor fixes